# Исправление проблемы с Groq API

## Проблема

Вы добавили `GROQ_API_KEY` в Railway, но приложение все равно показывает тестовый ответ вместо реального API.

## Причины и решения

### 1. API ключ не читается сервером

**Проверьте:**
- ✅ Имя переменной точно `GROQ_API_KEY` (заглавными буквами)
- ✅ Значение начинается с `gsk_`
- ✅ После добавления переменной **перезапустили сервис** (Redeploy)

**Как проверить:**
Откройте в браузере: `https://ваш-домен.railway.app/api/providers`

Если `groq` есть в списке `providers` → ключ настроен правильно ✅
Если нет → проверьте имя переменной и перезапустите сервис

### 2. Frontend не подключен к backend

**Проблема:** Frontend использует Mock API или неправильный URL.

**Решение:**
1. Откройте `frontend/telegram-config.js`
2. Найдите строку:
   ```javascript
   API_BASE_URL: 'https://your-api-domain.com/api',
   ```
3. Замените на URL вашего Railway backend:
   ```javascript
   API_BASE_URL: 'https://ваш-railway-домен.railway.app/api',
   ```
4. Сохраните и перезапустите frontend (если используете Vercel, сделайте новый деплой)

### 3. Ошибки скрываются fallback-ом

**Что изменилось:**
Теперь при ошибке API вы увидите реальное сообщение об ошибке вместо тестового ответа:
- Если ключ не настроен → увидите конкретное сообщение
- Если ошибка подключения → увидите инструкцию по проверке

## Быстрая проверка

1. **Проверьте переменные в Railway:**
   ```
   Railway Dashboard → Ваш проект → Variables
   Должна быть: GROQ_API_KEY = gsk_...
   ```

2. **Проверьте API endpoint:**
   ```
   https://ваш-домен.railway.app/api/providers
   ```
   Должен вернуть JSON с `groq` в списке `providers`

3. **Проверьте консоль браузера (F12):**
   - Должно быть: `Using real API: https://...`
   - НЕ должно быть: `Using mock API`

4. **Проверьте telegram-config.js:**
   - `API_BASE_URL` должен указывать на ваш Railway backend
   - НЕ должен быть `https://your-api-domain.com/api`

## Что было исправлено

1. ✅ `telegram-config.js` теперь правильно устанавливает `window.API_BASE_URL`
2. ✅ Улучшена логика определения окружения в `api.js`
3. ✅ Добавлена детальная диагностика ошибок вместо fallback на тестовый ответ
4. ✅ Улучшена проверка API ключей на сервере с понятными сообщениями об ошибках

## Если все еще не работает

1. **Проверьте логи Railway:**
   - Railway Dashboard → Deployments → Logs
   - Ищите ошибки при запуске сервера

2. **Проверьте через curl:**
   ```bash
   curl https://ваш-домен.railway.app/api/providers
   ```

3. **Проверьте консоль браузера:**
   - Откройте DevTools (F12)
   - Вкладка Console
   - Ищите ошибки при отправке сообщения

4. **Убедитесь, что сервис перезапущен:**
   - После добавления переменной окружения обязательно сделайте Redeploy

## Контакты и поддержка

Если проблема сохраняется, проверьте:
- Логи Railway на наличие ошибок
- Консоль браузера на наличие ошибок сети
- Правильность URL в `API_BASE_URL`
