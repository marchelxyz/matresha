# Настройка Yandex Object Storage

## Шаг 1: Создание аккаунта и проекта

1. Зарегистрируйтесь на [Yandex Cloud](https://cloud.yandex.ru/)
2. Создайте новый облачный проект или используйте существующий

## Шаг 2: Создание сервисного аккаунта и ключей

1. Перейдите в раздел **IAM** → **Сервисные аккаунты**
2. Создайте новый сервисный аккаунт (например, `storage-service-account`)
3. Назначьте роль **editor** или **storage.editor** для работы с хранилищем
4. Перейдите в раздел **IAM** → **Ключи**
5. Создайте статический ключ доступа:
   - Выберите созданный сервисный аккаунт
   - Нажмите "Создать новый ключ" → "Статический ключ доступа"
   - Сохраните `Access Key ID` и `Secret Access Key` (они показываются только один раз!)

## Шаг 3: Создание бакета (bucket)

1. Перейдите в раздел **Object Storage** → **Бакеты**
2. Нажмите "Создать бакет"
3. Укажите:
   - **Имя бакета**: например, `ai-assistant-files` (должно быть уникальным)
   - **Регион**: `ru-central1` (или другой по вашему выбору)
   - **Тип доступа**: `Публичный` (если нужны публичные ссылки) или `Приватный`
4. Нажмите "Создать бакет"

## Шаг 4: Настройка переменных окружения

Добавьте следующие переменные в ваш `.env` файл или в настройки Railway/Vercel:

```env
YANDEX_STORAGE_ENDPOINT=https://storage.yandexcloud.net
YANDEX_STORAGE_ACCESS_KEY=ваш-access-key-id
YANDEX_STORAGE_SECRET_KEY=ваш-secret-access-key
YANDEX_STORAGE_BUCKET=имя-вашего-бакета
YANDEX_STORAGE_REGION=ru-central1
```

### Для Railway:

1. Перейдите в настройки вашего проекта
2. Откройте вкладку **Variables**
3. Добавьте все переменные из списка выше

### Для локальной разработки:

1. Скопируйте `.env.example` в `.env`
2. Заполните значения переменных

## Шаг 5: Проверка работы

После настройки хранилище будет автоматически:
- Сохранять все загруженные файлы в облако
- Генерировать временные ссылки (действительны 7 дней)
- Организовывать файлы по папкам и датам

## Структура хранения файлов

Файлы сохраняются в следующей структуре:
```
bucket-name/
  └── chat-files/
      └── 2024/
          └── 01/
              └── 15/
                  └── uuid-filename.ext
```

## Ограничения и лимиты

- **Максимальный размер файла**: зависит от настроек вашего бакета (обычно до 5GB)
- **Время жизни ссылок**: 7 дней (можно изменить в коде)
- **Стоимость**: 
  - Хранение: от ~1.5₽/ГБ/месяц
  - Запросы: от ~0.01₽ за 1000 запросов
  - Исходящий трафик: от ~1₽/ГБ

## Отключение хранилища

Если вы не хотите использовать облачное хранилище, просто не заполняйте переменные окружения. Файлы будут обрабатываться в памяти сервера (как раньше).

## Безопасность

⚠️ **Важно**: 
- Никогда не коммитьте ключи доступа в Git
- Используйте переменные окружения для хранения ключей
- Регулярно ротируйте ключи доступа
- Используйте минимально необходимые права доступа для сервисного аккаунта

## Полезные ссылки

- [Документация Yandex Object Storage](https://cloud.yandex.ru/docs/storage/)
- [Консоль управления](https://console.yandex.cloud/storage)
- [Цены на Object Storage](https://cloud.yandex.ru/prices#storage)
