# Настройка API ключей на Railway

## Проблема: Приложение показывает тестовый ответ вместо реального API

Если вы видите тестовые ответы вместо реальных ответов от Groq AI, это означает, что:

1. **API ключ не настроен правильно** на Railway
2. **API_BASE_URL не настроен** в frontend
3. **Сервер не может прочитать переменные окружения**

## Решение

### Шаг 1: Добавьте API ключ в Railway

1. Откройте ваш проект на Railway: https://railway.app
2. Перейдите в раздел **Variables** (Переменные окружения)
3. Добавьте переменную:
   - **Имя:** `GROQ_API_KEY`
   - **Значение:** Ваш ключ от Groq (начинается с `gsk_`)
4. **ВАЖНО:** После добавления переменной **перезапустите сервис** (Redeploy)

### Шаг 2: Настройте API_BASE_URL во frontend

Откройте файл `frontend/telegram-config.js` и обновите:

```javascript
API_BASE_URL: 'https://ваш-railway-домен.railway.app/api',
```

Замените `ваш-railway-домен` на реальный домен вашего Railway приложения.

### Шаг 3: Проверьте настройки

#### Проверка 1: Проверьте доступные провайдеры

Откройте в браузере:
```
https://ваш-railway-домен.railway.app/api/providers
```

Должен вернуться JSON с доступными провайдерами. Если `groq` есть в списке `providers`, значит ключ настроен правильно.

#### Проверка 2: Проверьте логи Railway

1. Откройте Railway Dashboard
2. Перейдите в раздел **Deployments** → выберите последний деплой
3. Откройте **Logs**
4. Проверьте, нет ли ошибок при запуске сервера

#### Проверка 3: Проверьте переменные окружения

В Railway Dashboard → Variables убедитесь, что:
- ✅ Переменная называется именно `GROQ_API_KEY` (без пробелов, с заглавными буквами)
- ✅ Значение начинается с `gsk_`
- ✅ Нет лишних пробелов или кавычек в значении

## Частые ошибки

### Ошибка: "Groq API key not configured"

**Причина:** Переменная окружения не найдена или имеет неправильное имя.

**Решение:**
1. Проверьте имя переменной: должно быть `GROQ_API_KEY` (точно так)
2. Убедитесь, что значение скопировано полностью (без пробелов в начале/конце)
3. Перезапустите сервис после добавления переменной

### Ошибка: "Failed to fetch" или "NetworkError"

**Причина:** Frontend не может подключиться к backend.

**Решение:**
1. Проверьте `API_BASE_URL` в `telegram-config.js`
2. Убедитесь, что Railway сервис запущен и доступен
3. Проверьте CORS настройки (должны быть настроены автоматически)

### Ошибка: Тестовый ответ все еще показывается

**Причина:** Frontend использует Mock API вместо реального.

**Решение:**
1. Убедитесь, что `API_BASE_URL` настроен правильно
2. Проверьте консоль браузера (F12) - должно быть сообщение "Using real API"
3. Если видите "Using mock API", значит `API_BASE_URL` не установлен

## Диагностика

### Проверка через curl

```bash
# Проверка health endpoint
curl https://ваш-railway-домен.railway.app/api/health

# Проверка доступных провайдеров
curl https://ваш-railway-домен.railway.app/api/providers

# Тест запроса к Groq (замените YOUR_MESSAGE на ваш текст)
curl -X POST https://ваш-railway-домен.railway.app/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "Привет", "provider": "groq"}'
```

### Проверка в коде

Откройте консоль браузера (F12) и проверьте:
- `window.API_BASE_URL` - должен содержать URL вашего Railway backend
- В логах должно быть "Using real API: ..."

## После исправления

После того как вы:
1. ✅ Добавили `GROQ_API_KEY` в Railway Variables
2. ✅ Настроили `API_BASE_URL` в `telegram-config.js`
3. ✅ Перезапустили Railway сервис

Приложение должно работать с реальным Groq API вместо тестовых ответов.

## Получение ключа Groq

1. Перейдите на https://console.groq.com
2. Зарегистрируйтесь или войдите
3. Перейдите в раздел **API Keys**
4. Создайте новый ключ
5. Скопируйте ключ (начинается с `gsk_`)
6. Добавьте его в Railway как `GROQ_API_KEY`
